\documentclass[a4paper, landscape]{article}
\usepackage{prerex}
\usepackage{multicol}
%\usepackage{showframe}
\usepackage[utf8]{inputenc} % codificacao de caracteres
\usepackage{geometry}
\usepackage[portuguese]{babel}
\usepackage{gensymb}
%\usepackage{lmodern}
\usepackage{tikz}
\usepackage{xcolor}
\usetikzlibrary{calc}
\usepackage{ifthen}
\usepackage{disciplinasDB}
\tikzset{
    %Define standard arrow tip
    >=stealth,
    %Define style for boxes
    box/.style={
           rectangle,
           draw=black,
           text width=7em,
           minimum height=5em,
           text centered,
           inner sep=1mm]},
    % Define arrow style
    pil/.style={
           ->,
           thick,
           shorten <=3pt,
           shorten >=3pt,},
}
\usetikzlibrary{positioning,shapes,shadows,arrows}

\colorlet{cbasico}{yellow}
\colorlet{cdesc}{orange}
\colorlet{celetronica}{green}
\colorlet{celetrica}{blue!20!white}
\colorlet{cambiental}{olive!20!white}
\colorlet{cindustrial}{violet!40!white}
\colorlet{celetiva}{orange!50!white}
\colorlet{cextensao}{orange!20!white}
% Define estilos de caixas de acordo com a origem da disciplina
\tikzstyle{basico}=[box, fill=cbasico]
\tikzstyle{desc}=[box, fill=cdesc]
\tikzstyle{eletronica}=[box, fill=celetronica]
\tikzstyle{eletrica}=[box, fill=celetrica]
\tikzstyle{ambiental}=[box, fill=cambiental]
\tikzstyle{industrial}=[box, fill=cindustrial]
\tikzstyle{eletiva}=[box, fill=celetiva, dashed]
\tikzstyle{extensao}=[box, fill=cextensao, dashed]
\tikzstyle{info}=[box, fill=yellow]

%contador de creditos totais do curso
\newcounter{cred} 
\setcounter{cred}{0}

%contador de créditos para disciplinas de extensão
\newcounter{credExtensao} 
\setcounter{credExtensao}{0} 

%contador de disciplinas totais do curso
\newcounter{tdisciplinas} 
\setcounter{tdisciplinas}{0}

%parâmetros de cada disciplina
%{basico || eletronica || desc || eletiva || extensao} 	#1
%{Período} de 1 a 10 							#2
%{Linha no fluxograma} de 1 a 6. 	#3
%{Código da disciplina} 					#4
%{Nome da Disciplina} 						#5
%{Número de Créditos} 						#6
%{nome abreviado para referência} #7
\newcommand{\disciplina}[7] {
  \addtocounter{cred}{#6}
  \def\horasdisc{\inteval{15 * #6}}%  Cada crédito correspponde a 15 horas
  \ifthenelse{\equal{#1}{extensao}}
    {\addtocounter{credExtensao}{#6}} % Se for extensao, conta também como crédito de extensão
    {} % Caso contrário, não faz nada
  \addtocounter{tdisciplinas}{1} % Conta o número de disciplinas
  \node at ($ (#2*2.8cm-7cm,14.6-#3*2.3) $) (Item)  [#1] (#7) 
        {
            \textbf{#4}\\ % Código da disciplina
            \textbf{#5}\\ % Nome da disciplina
            \textbf{\horasdisc} \hfill #6 % Horas e Número de créditos
        };}

\geometry{margin=0.5cm,bottom=0.5cm} 

\thispagestyle{empty}
\usepackage{fontspec}
\usepackage{helvet}


\setmainfont{Arial}
\begin{document}
\noindent
{\Large \textbf{Curso: Engenharia}}\\
{\Large \textbf{Habilitação: Computação}}  (Versão de \today)

\begin{tikzpicture}
  % Escreve os períodos no topo da página
  \foreach \x in {1,...,10} {\node at (\x*2.8-7,13.5) {\x\degree Período};}

  \footnotesize
  %\fontfamily{lms}\fontseries{l}\selectfont
  %parâmetros de cada disciplina, pode ser posto numa única linha
  %\disciplina
  %{basico || eletronica || desc || eletiva || extensao}
  %{Período} de 1 a 10
  %{Linha no fluxograma} de 1 a 8.
  %{Código da disciplina}
  %{Nome da Disciplina}
  %{Número de Créditos}
  %{nome abreviado para referência} 

  %Básico
  \disciplina{basico}{1}{3}{\AlgLinCod} {\AlgLinSName}  {\AlgLinCred} {AlgLin}  % Álgebra Linear
  \disciplina{basico}{1}{4}{\CalcICod}	{\CalcISName}	  {\CalcICred}  {CalcI}   % Cálculo I
  \disciplina{basico}{2}{4}{\CalcIICod}	{\CalcIISName}	{\CalcIICred} {CalcII}  % Cálculo II
  \disciplina{basico}{3}{4}{\CalcIIICod}{\CalcIIISName}	{\CalcIIICred}{CalcIII} % Cálculo III
  \disciplina{basico}{2}{3}{\CalcNumCod}{\CalcNumSName} {\CalcNumCred}{CalcNum} % Cálculo Numérico
  \disciplina{basico}{2}{5}{\FisICod}		{\FisISName}		{\FisICred}   {FisI}    % Física I
  \disciplina{basico}{2}{6}{\FisEICod}	{\FisEISName}	  {\FisEICred}  {FisEI}   % Física Experimental I
  \disciplina{basico}{3}{5}{\FisIICod}	{\FisIISName}		{\FisIICred}	{FisII}   % Física II
  \disciplina{basico}{3}{6}{\FisEIICod}	{\FisEIISName}	{\FisEIICred}	{FisEII}  % Física Experimental II
  \disciplina{basico}{4}{5}{\FisIIICod}	{\FisIIISName}	{\FisIIICred}	{FisIII}  % Física III
  \disciplina{basico}{4}{6}{\FisEIIICod}{\FisEIIISName}	{\FisEIIICred}{FisEIII} % Física Experimental III
  \disciplina{basico}{5}{6}{\FisIVCod}	{\FisIVSName}		{\FisIVCred}	{FisIV}   % Física IV
  \disciplina{basico}{5}{7}{\FisEIVCod}	{\FisEIVSName}	{\FisEIVCred}	{FisEIV}  % Física Experimental IV
  \disciplina{basico}{3}{3}{\ProbEstCod}{\ProbEstSName}	{\ProbEstCred}{ProbEst} % Probabilidade e Estatística

  %disciplinas de outros departamentos da engenharia
  \disciplina{industrial}{10}{4}{\AdmCod}	    {\AdmSName}	      {\AdmCred}		{Adm} % Administração
  \disciplina{eletrica}{5}{5}	{\CCCCod}	      {\CCCSName}		    {\CCCCred}		{CCC} % Circuitos em corrente Conínua
  \disciplina{eletrica}{6}{5}{\CCACod}	      {\CCASName}		    {\CCACred}		{CCA} % Circuitos em Corrente Alternada
  \disciplina{eletronica}{6}{6}{\EletICod}    {\EletISName}     {\EletICred}  {EletI} % Eletrônica I
  \disciplina{industrial}{8}{1}{\EmpreCod}    {\EmpreSName}     {\EmpreCred}  {Empre} % Empreendedorismo
  \disciplina{industrial}{7}{6}{\MacroEcoCod} {\MacroEcoSName}  {\MacroEcoCred}{MacroEco} % Macro economia aplicada à Engenharia
  \disciplina{ambiental}{1}{5}	{\IntAmbCod}	{\IntAmbSName}    {\IntAmbCred} {IntAmb} % Introdução à Engenharia Ambiental
  \disciplina{eletrica}{5}{4}	{\MatEleCod}	  {\MatEleSName}    {\MatEleCred} {MatEle} % Materiais Elétricos
  \disciplina{eletrica}{5}{3} {\SinaisESistCod}{\SinaisESistSName}{\SinaisESistCred}{SeS} % Modelos Matemáticos
  \disciplina{eletrica}{4}{4} {\LogCircDigCod}{\LogCircDigSName}{\LogCircDigCred}{LogCircDig} % Lógica e Circuitos Digitais


  %Disciplinas Desc
  \disciplina{desc}{1}{1} {\AlgCompCod}	{\AlgCompSName}{\AlgCompCred}{AlgComp}  % Algoritmos Computacionais
  \disciplina{desc}{3}{1} {\AnAlgCod}	{\AnAlgSName}{\AnAlgCred}{AnAlg}          % Análise de Algoritmos
  \disciplina{desc}{5}{1} {\GrafosCod}	{\GrafosSName}{\GrafosCred}{Grafos}     % Teoria de Grafos e Aplicações
  \disciplina{desc}{6}{4} {\ArqCompCod}	{\ArqCompSName}{\ArqCompCred}{ArqComp}  % Arquitetura de Computadores
  \disciplina{desc}{8}{6}{\ControlCod}	{\ControlSName}{\ControlCred}{Control}  % Controle
  \disciplina{desc}{1}{2} {\EngCompSocCod}	{\EngCompSocSName}{\EngCompSocCred}{ETS} % Engenharia e Sociedade
  \disciplina{desc}{6}{3} {\EngSistACod}	{\EngSistASName}{\EngSistACred}{EngSistA} % Engenharia de Sistemas A
  \disciplina{desc}{8}{2} {\AnaProjSistCod}	{\AnaProjSistSName}{\AnaProjSistCred}{AnaProjSist} % Sistemas de Informação
  \disciplina{desc}{7}{3} {\ProjBDCod}	{\ProjBDSName}{\ProjBDCred}{EngSistB}   % Engenharia de Sistemas B
  \disciplina{extensao}{9}{3} {\EstSupCod}	{\EstSupSName}{\EstSupCred}{EstSup} % Estágio Supervisionado
  \disciplina{desc}{2}{1} {\EstrInfCod}	{\EstrInfSName}{\EstrInfCred}{EstrInf}  % Estruturas de Informação
  \disciplina{desc}{5}{2} {\FundCompCod}	{\FundCompSName}{\FundCompCred}{FundComp} % Fundamentos de Computadores
  \disciplina{desc}{6}{1} {\ICCod}	{\ICSName}{\ICCred}{IC}                     % Inteligência Computacional I
  \disciplina{desc}{6}{2} {\ICIICod}	{\ICIISName}{\ICIICred}{ICII}             % Inteligência Computacional II
  \disciplina{desc}{9}{4} {\InstalaCod}	{\InstalaSName}{\InstalaCred}{Instala}  % Instalações Ambiente Computacional I
  \disciplina{desc}{4}{1} {\LabProgACod}	{\LabProgASName}{\LabProgACred}{LabProgI} % Laboratório de Programação I
  \disciplina{desc}{4}{2} {\LabProgPOOCod}	{\LabProgPOOSName}{\LabProgPOOCred}{LabProgII} % Laboratório de Programação II
  \disciplina{desc}{2}{2} {\LogProgCod}	{\LogProgSName}{\LogProgCred}{LogProg}  % Lógica de Programação
  \disciplina{desc}{7}{1}	{\MineraDadosCod}	{\MineraDadosSName}{\MineraDadosCred}{MineraDados} % Mineração de Dados
  \disciplina{desc}{4}{3} {\ProcImagCod}	{\ProcImagSName}{\ProcImagCred}{ProcIma} % Processamento de Imagens
  \disciplina{desc}{8}{5} {\CompParalCod}	{\CompParalSName}{\CompParalCred}{ProgPara} % Programação Paralela
  \disciplina{desc}{9}{1} {\ProjACod}	{\ProjASName}{\ProjACred}{ProjA}          % Projeto A
  \disciplina{desc}{10}{1}{\ProjBCod}	{\ProjBSName}{\ProjBCred}{ProjB}          % Projeto B
  \disciplina{desc}{8}{4} {\SredesCod}	{\SredesSName}{\SredesCred}{Sredes}     % Segurança em Redes de Computadores
  \disciplina{desc}{7}{5} {\ProjSOCod}	{\ProjSOSName}{\ProjSOCred}{SO}         % Sistemas Operacionais
  \disciplina{desc}{8}{3} {\SistEmbCod}	{\SistEmbSName}{\SistEmbCred}{SistEmb}  % Sistemas Embutidos
  \disciplina{desc}{7}{4} {\TelepCod}	{\TelepSName}{\TelepCred}{Telep}          % Redes
  \disciplina{desc}{7}{2} {\TeoCompCod}	{\TeoCompSName}{\TeoCompCred}{Comp}     % Teoria da Compiladores
  \disciplina{extensao}{3}{2} {\ExtCod}	{\ExtSName}{\ExtCred}{Ext}              % Projetos de Extensão

  %eletivas
  \disciplina{eletiva}{9}{2} {\EletACod}	{Eletiva Restrita}{\EletACred}{EA}
  \disciplina{eletiva}{10}{2}{\EletACod}	{Eletiva Restrita}{\EletACred}{EB}
  \disciplina{eletiva}{10}{3}{\EletACod}	{Eletiva Restrita}{\EletACred}{EC}

  %ligação com pre-requititos
  % Uma linha direta para o próximo bloco
  \newcommand{\prereq}[3][black] { % \prereq[cor]{disciplina}{pre}
    \draw [->, thick, #1](#2.east)--(#3.west);}

  % um caminho mais complexo até o próximo bloco
  % \pre[cor]{disciplina}{prérequisito}{distância horizontal}{distância vertical}{distância horizontal}{distância vertical}
  % #1 cor da linha , opcioanl. Se não espcificado, é escolhido black
  % #2 disciplina prérequisito
  % #3 disciplina seguinte
  % #4 distância do centro de saída do bloco prérequisito, face direita
  % #5 distância da linha horizontal do bloco final
  % #6 Se 0, seta toma caminho mais simples, virando horizontal e depois verticalmente para atingir o bloco seguinte
  % #7 offset vertical do bloco final
  \newcommand{\pre}[8][black] {
    \draw [->, thick, #1]
    ($(#2.east) + (0 mm,#4mm) $) -| % #4 distância do centro de saída do bloco prérequisito, face direita
    \ifnum#6=0
      % se #6=0, seta toma caminho mais simples, virando horizontal e depois verticalmente para atingir o bloco seguinte
      % usado quando o prérequisito está no período anterior da disciplina seguinte
      ($ (#3.west)+(-#5mm,#7mm)$) -- % #5 distância horizontal do bloco final, #7 offset vertical do bloco final
      ($(#3.west)+(0,#7mm)$);
      \else
      %% se #6!=0, seta toma caminho mais complexo, para atingir o bloco seguinte
      ($(#2.east) + (#5mm,#6mm) $) -| % #5 quanto se afasta do préreq. e #6 quanto sobe/desc linha vertical
      ($(#3.west) - (#7mm,#8mm)$) -- ($(#3.west) - (0,#8mm)$); % #7 distância horizontal do bloco final, #8 onde entra no bloco final
    \fi
  }

  %Período 1
  \prereq			  {AlgComp}	{EstrInf}
  \pre  [olive] {AlgComp}	{CalcNum}   {-4}{4}{0}{3}{0}
  \pre	[red]   {AlgComp}	{AnAlg}     {-1}{5}{-8}{4}{0}
  \pre	[blue]  {AlgComp}	{FundComp}  {-2}{4}{-15}{2}{-4}
  \pre          {LogProg} {AnAlg}     {2}{3}{0}{-2}{0}
  \pre	[blue]	{CalcI}		{CalcNum}   {5}{4}{0}{-3}{0}
  \prereq				{CalcI}		{CalcII}
  \pre	[red]	  {CalcI}	  {ProbEst}   {2}{4}{14}{2}{0}
  \pre	[blue]	{AlgLin}  {ProcIma}   {5}{1}{9}{3}{-2}

  % Período 2
  \pre          {EstrInf}	{LabProgI}  {2}{3}{8}{2}{-3}
  \pre  [blue]  {EstrInf}	{Grafos}    {4}{1}{9}{2}{-3}
  \pre  [teal] 	{EstrInf}	{LabProgII} {-3}{1}{-13}{4}{-4}
  \prereq				{CalcII}	{CalcIII}
  \prereq				{FisI}		{FisII}
  \prereq				{FisEI}		{FisEII}
  \pre  [blue]   {CalcIII}	{SeS}   {-1}{1}{13}{3}{-1}
  \pre  [olive]  {LogProg} {LabProgI}       {0}{5}{15}{4}{0}
  \pre          {LogProg} {LabProgII}       {-2}{3}{-10}{3}{0}


  % %Período 3
  \pre[red]     {AnAlg}		{Comp}       {-4}{4}{-13}{2}{0}
  \pre	[blue]  {AnAlg}	  {Grafos}     {-2}{5}{-8}{2}{3}
  \prereq				{FisII}		{FisIII}
  \prereq				{FisEII}  {FisEIII}
  \prereq [red]	{ProbEst}	{ProcIma}
  \pre  	      {LabProgI}{IC}          {-1}{3}{-10}{3}{0}
  \pre[teal]   	{LabProgI}{ICII}        {-3}{2}{-12}{5}{-2}

  % Período 4
  \pre[blue]    {LabProgII}{EngSistA} {3}{1}{-9}{5}{-2}
  \pre				{FisIII}	{FisIV}       {-3}{4}{0}{0}{-4}
  \pre [red]	  {FisIII}	{MatEle}    {3}{2}{0}{-4}{0}
  \pre	      {LogCircDig} {FundComp} {5}{4}{0}{-3}{0}
  \prereq [teal] 	{FisIII}	{CCC}
  \pre [red]		{SeS}	{CCA}   {0}{5}{0}{4}{0}
  \pre	  {CCC}	{EletI}               {-3}{4}{0}{0}{-4}
  \prereq[blue]	  {CCC}		  {CCA}


  % Período 5
  \pre[purple]	{FundComp}{ArqComp} {-3}{3}{0}{3}{2}
  \pre			{FisEIII}		{FisEIV}    {-3}{4}{0}{0}{-4}

  % Período 6
  \prereq		    {EngSistA}{EngSistB}
  \pre[blue]		{ArqComp}	            {SO}{-3}{3}{0}{3}{1}
  \prereq[red]		  {ArqComp}	{Telep}
  \pre				  {ArqComp}	{SistEmb}   {3}{3}{10}{4}{0}
  \prereq[teal]  {IC}		  {MineraDados}
  \pre[black]    {CCA}{Instala}       {3}{1}{10}{4}{-2}

  % Período 7
  \prereq				{SO}		{ProgPara}
  \prereq[red] {Telep} {Sredes}
  \pre   {EngSistB}{AnaProjSist}      {3}{2}{0}{1}{0}

  % Período 8

  \pre	[blue]		{SO}		{Control}   {-1}{4}{0}{1}{0}

  % % Período 9
  \prereq				{ProjA}		{ProjB}

  % pre de créditos
  \newcommand{\trava}[2] {
    \node [below left=0mm and -20mm of #1,text width=40pt, font=\scriptsize] (#2) {#2};
    \draw [->, thick]
    ($(#2.west)  $)  -| ($ (#1.west) -(2mm,4mm)$) -- ($(#1.west) -(0,4mm)  $);}

  %\trava {ETS}{94 cred}
  \trava {EA}{150 cred}
  \trava {EB}{150 cred}
  \trava {EC}{150 cred}
  \trava {EstSup}{150 cred}
  \trava {ProjA}{150 cred}


  \node at (20cm,14mm) (legenda)
  {\textbf{Código para as Disciplinas}};
  \node  [below right= 1.5mm and -36mm of legenda,fill=cbasico, draw=black,
    label=right:Básico.](basico) {};
  \node [right  of=basico,node distance=22mm,fill=cextensao, draw=black, label=right:Extensão] (extensao) { };
  \node [below  of=basico,node distance=5mm,fill=cambiental, draw=black, label=right:Ambiental] (ambient) { };
  \node [below  of=extensao,node distance=5mm,fill=cindustrial, draw=black, label=right:Industrial] (indust) { };
  \node [below  of=ambient,node distance=5mm,fill=celetrica, draw=black, label=right:Elétrica] (eletri) { };
  \node [below  of=indust,node distance=5mm,fill=celetronica, draw=black, label=right:Eletrônica] (prof) { };
  \node [below of=eletri,node distance=5mm,fill=cdesc, draw=black, label=right:Computacão] (especifico){};
  \node [below of=prof,node distance=5mm,fill=celetiva, draw=gray, draw=black, label=right:Eletivas] {};

\end{tikzpicture}

% calcula as horas de disciplinas de extensão
\newcounter{horasDiscExtensao}
\setcounter{horasDiscExtensao}{\inteval{15 * \the\value{credExtensao}}}

% conta horas totais do curso sem contar extensão
\newcounter{horasSemExtensao}
\setcounter{horasSemExtensao}{\inteval{15 * (\the\value{cred} - \the\value{credExtensao})}}

%  horas totais das disciplinas com disciplinas de extensão
\newcounter{horasTotaisDisciplinas}
\setcounter{horasTotaisDisciplinas}{\inteval{15 * \the\value{cred}}}

% Calcula horas totais necessárias para extensão
\newcounter{hExtensao}
\setcounter{hExtensao}{\the\value{horasSemExtensao}}
\divide\value{hExtensao} by 9

% calcula horas totais do curso
\newcounter{thoras}
\setcounter{thoras}{\the\value{horasSemExtensao}}
\addtocounter{thoras}{\the\value{hExtensao}}

% conta horas de atividades de extensão
\newcounter{horasACE}
\setcounter{horasACE}{\inteval{\the\value{hExtensao} - \the\value{horasDiscExtensao}}}

% disciplinas eletivas
\newcounter{tEletivas}
\setcounter{tEletivas}{3} % 3 eletivas de 4 créditos cada

% conta disciplinas obrigatórias
\newcounter{tDiscObrigatorias}
\setcounter{tDiscObrigatorias}{\inteval{\the\value{tdisciplinas} - \the\value{tEletivas}}}

\vspace{-4mm}
\setlength\parindent{0pt}

\begin{multicols}{4}
  \vfill
  Os números situados na parte inferior esquerda e direita representam carga horária e créditos, respectivamente, conferidos à disciplina.

  \columnbreak
  O Curso de Engenharia de Computação será integralizado em um mínimo de 10 e um máximo de 18 períodos.

  \columnbreak
  \the\value{tdisciplinas} disciplinas\\
  % \addtocounter{cred}{-13}
  \the\value{cred} créditos em disciplinas obrigatórias\\ sendo \the\value{credExtensao} créditos em disciplinas de extensão\\e 12 créditos em disciplinas eletivas restritas

  \columnbreak
  %Total de horas-aula do curso: \the\value{haula}\\
  %\addtocounter{thoras}{1} % Arredonda para cima
  Total de horas do curso: \the\value{thoras}\\
  Total de horas do curso (sem ext.): \the\value{horasSemExtensao}\\
  Total de horas de extensão: \the\value{hExtensao}


\end{multicols}

% Exporta o valor para um arquivo externo
% Só funciona com o luatex
\newwrite\exportfile
\immediate\openout\exportfile=dados.tex
% Escreve um comentário no arquivo
\begingroup
\catcode`\%=12 % faz o % ser apenas texto
\immediate\write\exportfile{% NAO EDITE MANUALMENTE}
\immediate\write\exportfile{% Este arquivo foi gerado automaticamente em \the\year-\the\month-\the\day}
\endgroup

\immediate\write\exportfile{%
  \noexpand\newcommand{\string\totalHorasCurso}{\thethoras\noexpand\xspace}^^J%
  \noexpand\newcommand{\string\horasTotaisDisciplinas}{\thehorasTotaisDisciplinas\noexpand\xspace}^^J%
  \noexpand\newcommand{\string\totalCredCurso}{\thecred\noexpand\xspace}^^J%
  \noexpand\newcommand{\string\horasExtensao}{\thehExtensao\noexpand\xspace}^^J%
  \noexpand\newcommand{\string\totalHorasSemExtensao}{\thehorasSemExtensao\noexpand\xspace}^^J%
  \noexpand\newcommand{\string\horasDiscExtensao}{\thehorasDiscExtensao\noexpand\xspace}^^J%
  \noexpand\newcommand{\string\totalCredDiscExtensao}{\thecredExtensao\noexpand\xspace}^^J%
  \noexpand\newcommand{\string\totalHorasACE}{\thehorasACE\noexpand\xspace}^^J%
  \noexpand\newcommand{\string\totalDisciplinas}{\thetdisciplinas\noexpand\xspace}^^J%
  \noexpand\newcommand{\string\totalEletivas}{\thetEletivas\noexpand\xspace}^^J%
  \noexpand\newcommand{\string\tDiscObrigatorias}{\thetDiscObrigatorias\noexpand\xspace}^^J%
}
\immediate\closeout\exportfile
\end{document}
